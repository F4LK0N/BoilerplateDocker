#!/bin/sh
set -e

echo "##########################################################################";
echo "### CONTAINER SETUP ###";
echo "##########################################################################";

if [[ -f "/run/container/setup-done" ]]; then
    echo "[===]";
else
    echo "### FILESYSTEM ###";
    # Container
    rm -rf /run/container/;
    
    setup-fs 777 root root /tmp/test;
    setup-fs 777 root root /tmp/test/;
    setup-fs 777 root root /tmp/test/;
    
    setup-fs 777 daemon daemon /tmp/test2/;
    setup-fs 777 daemon daemon /tmp/test2;
    setup-fs 777 daemon daemon /tmp/test2;

    setup-fs 777 root2 daemon /tmp/test2/;
    setup-fs 777 daemon root2 /tmp/test2/;
    
    setup-fs 999 root root /tmp/test3/;
    
    setup-fs-clear-error;
    if [[ "$( setup-fs-has-error )" == "1" ]]; then
        echo "ERROR"; setup-fs-clear-error; exit 1;
    fi;

exit 1;

    setup-fs 777 root root ${ROOT_DATA}/;
    setup-fs 777 root root ${ROOT_LOGS}/;
    setup-fs 777 root root /run/container/;
    setup-fs 777 root root /run/container;
    # OS
    setup-fs 777 root root ${OS_DATA}/;
    setup-fs 777 root root ${OS_LOGS}/;
    # App
    setup-fs 777 root root ${APP_ROOT}/;

    #if [[ "${CONTAINER_SETUP_ERROR}" == "1" ]]; then
    #    echo "[ERROR]"; exit 1;
    #else
    #    setup-fs 777 root root /run/container/setup-done;
    #    echo "[DONE]";
    #fi
fi
