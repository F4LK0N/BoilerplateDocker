#!/bin/sh
set -e

echo "### CONTAINER START ###";

if [[ -f "${OS_DATA}/container/start-done" ]]; then

    echo "[OK]";

else
    
    echo "LOGS - OS";
    if [[ ! -e "${OS_LOGS}/logs-link" ]]; then
        ln -s "/var/log" "${OS_LOGS}/logs-link"
        chmod 777 "${OS_LOGS}/logs-link"
    fi


    echo "LOGS - APACHE";
    if [[ -f "${HTTPD_LOGS}/access.log" ]]; then
        truncate -s 0 ${HTTPD_LOGS}/access.log;
    fi


    echo "LOGS - PHP";
    #...


    echo "COMPOSER - UPDATE";
    composer update -d ${APP_ROOT};


    touch "${OS_DATA}/container/start-done"
    chmod 777 "${OS_DATA}/container/start-done"
    echo "[DONE]"

fi
