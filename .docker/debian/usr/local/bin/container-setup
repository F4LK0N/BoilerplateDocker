#!/bin/bash
set -e

echo "### CONTAINER SETUP ###";

if [[ -f "${OS_DATA}/container/setup-done" ]]; then

    echo "[OK]";

else
    
    echo "FILESYSTEM - CLEAR";
    rm -rf ${OS_DATA}/container;
    
    
    echo "FILESYSTEM - CREATE";
    # Container
    mkdir -p --mode=777 ${ROOT_DATA};
    mkdir -p --mode=777 ${ROOT_LOGS};
    # OS
    mkdir -p --mode=777 ${OS_DATA};
    mkdir -p --mode=777 ${OS_DATA}/container;
    mkdir -p --mode=777 ${OS_LOGS};
    # Application
    mkdir -p --mode=777 ${APP_ROOT};


    echo "FILESYSTEM - PERMISSIONS";
    # Container
    chmod 777 ${ROOT_DATA};
    chmod 777 ${ROOT_LOGS};
    # OS
    chmod 777 ${OS_DATA};
    chmod 777 ${OS_DATA}/container;
    chmod 777 ${OS_LOGS};
    # Application
    chmod 777 ${APP_ROOT};


    touch "${OS_DATA}/container/setup-done"
    chmod 777 "${OS_DATA}/container/setup-done"
    echo "[DONE]"

fi
